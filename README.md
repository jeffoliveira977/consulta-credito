# Desafio Técnico - API de Consulta de Créditos

Este repositório contém o desenvolvimento da API RESTful para a consulta de créditos constituídos, conforme o desafio técnico proposto. A API foi construída utilizando Spring Boot e fornece informações essenciais sobre os créditos.

## Objetivo

Desenvolver uma API RESTful em Spring Boot para a consulta de créditos constituídos, expondo informações como número do crédito, número da NFS-e, data de constituição, valor do ISSQN, tipo do crédito, entre outros. Adicionalmente, um front-end em Angular para consumir esta API e exibir os dados ao usuário foi desenvolvido (encontrado em um diretório separado ou repositório).

## Requisitos Técnicos

* **Back-end:** Java 8+, Spring Boot, Spring Data JPA, Hibernate
* **Banco de Dados:** PostgreSQL (configurado para execução local via Docker Compose)
* **Front-end:** Angular 2+ (em diretório/repositório separado)
* **Containerização:** Docker (API e front-end)
* **Mensageria:** Kafka (implementado para notificar consultas)
* **Testes Automatizados:** JUnit, Mockito (testes unitários para o back-end)
* **Padrões de Projeto:** MVC, Repository, Factory, Singleton (utilizados conforme a necessidade)

## Estrutura da API

### Endpoints

* **GET /api/creditos/{numeroNfse}**
    * **Descrição:** Retorna uma lista de créditos constituídos com base no número da NFS-e.
    * **Parâmetro:**
        * `numeroNfse` (String) - Número identificador da NFS-e
    * **Resposta Esperada (JSON):**
        ```json
        [
          {
            "numeroCredito": "123456",
            "numeroNfse": "7891011",
            "dataConstituicao": "2024-02-25",
            "valorIssqn": 1500.75,
            "tipoCredito": "ISSQN",
            "simplesNacional": true,
            "aliquota": 5.0,
            "valorFaturado": 30000.00,
            "valorDeducao": 5000.00,
            "baseCalculo": 25000.00
          }
        ]
        ```

* **GET /api/creditos/credito/{numeroCredito}**
    * **Descrição:** Retorna os detalhes de um crédito constituído específico com base no número do crédito constituído.
    * **Parâmetro:**
        * `numeroCredito` (String) - Número identificador do crédito constituído
    * **Resposta Esperada (JSON):**
        ```json
        {
          "numeroCredito": "123456",
          "numeroNfse": "7891011",
          "dataConstituicao": "2024-02-25",
          "valorIssqn": 1500.75,
          "tipoCredito": "ISSQN",
          "simplesNacional": true,
          "aliquota": 5.0,
          "valorFaturado": 30000.00,
          "valorDeducao": 5000.00,
          "baseCalculo": 25000.00
        }
        ```

## Modelagem de Dados

A entidade `Credito` representa a estrutura dos dados de crédito no sistema.

```java
@Entity
public class Credito {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String numeroCredito;
    private String numeroNfse;
    private LocalDate dataConstituicao;
    private BigDecimal valorIssqn;
    private String tipoCredito;
    private boolean simplesNacional;
    private BigDecimal aliquota;
    private BigDecimal valorFaturado;
    private BigDecimal valorDeducao;
    private BigDecimal baseCalculo;
}
```

O script SQL para a criação da tabela `credito` é o seguinte:

```sql
CREATE TABLE credito
(
    id                  BIGINT GENERATED BY DEFAULT AS IDENTITY,
    numero_credito      VARCHAR(50)    NOT NULL,
    numero_nfse         VARCHAR(50)    NOT NULL,
    data_constituicao   DATE           NOT NULL,
    valor_issqn         DECIMAL(15, 2) NOT NULL,
    tipo_credito        VARCHAR(50)    NOT NULL,
    simples_nacional    BOOLEAN        NOT NULL,
    aliquota            DECIMAL(5, 2)  NOT NULL,
    valor_faturado      DECIMAL(15, 2) NOT NULL,
    valor_deducao       DECIMAL(15, 2) NOT NULL,
    base_calculo        DECIMAL(15, 2) NOT NULL
);
```

E o script para a população inicial da tabela:

```sql
INSERT INTO credito (numero_credito, numero_nfse, data_constituicao, valor_issqn, tipo_credito, simples_nacional, aliquota, valor_faturado, valor_deducao, base_calculo)
VALUES
('123456', '7891011', '2024-02-25', 1500.75, 'ISSQN', true, 5.0, 30000.00, 5000.00, 25000.00),
('789012', '7891011', '2024-02-26', 1200.50, 'ISSQN', false, 4.5, 25000.00, 4000.00, 21000.00),
('654321', '1122334', '2024-01-15', 800.50, 'Outros', true, 3.5, 20000.00, 3000.00, 17000.00);
```
## Pré-requisitos

* Docker instalado.
* Docker Compose instalado.

## Como Executar

1.  Clone o repositório.
2.  Navegue até a raiz do projeto.
3.  Execute: `docker-compose up -d`
4.  A API estará acessível em `http://localhost:8080`.
5.  O front-end estará acessível em `http://localhost:4200`.
6.  O banco de dados PostgreSQL estará rodando em `http://localhost:5432`.
7.  O Kafka estará rodando em `http://localhost:9092`
8.  O Apache Zookeper estará rodando em `http://localhost:2181`

## Testes

Testes unitários foram implementados para o back-end utilizando JUnit e Mockito. Os testes podem ser executados através da sua IDE ou utilizando o Maven wrapper: `./mvnw test`
